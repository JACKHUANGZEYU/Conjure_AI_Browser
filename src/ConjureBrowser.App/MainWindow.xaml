<Window x:Class="ConjureBrowser.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:cef="clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf"
        mc:Ignorable="d"
        Title="Conjure Browser"
        Height="720"
        Width="1200">
    <DockPanel LastChildFill="True">
        <!-- Top toolbar -->
        <Border DockPanel.Dock="Top" Padding="6" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Name="BackButton" Width="36" Margin="0,0,6,0" Content="â†" Click="Back_Click" />
                <Button Grid.Column="1" Name="ForwardButton" Width="36" Margin="0,0,6,0" Content="â†’" Click="Forward_Click" />
                <Button Grid.Column="2" Name="ReloadButton" Width="36" Margin="0,0,6,0" Content="âŸ³" Click="Reload_Click" />
                <Button Grid.Column="3" Width="36" Margin="0,0,6,0" Content="ðŸ " Click="Home_Click" />

                <TextBox Grid.Column="4"
                         Name="AddressBar"
                         Margin="0,0,6,0"
                         VerticalContentAlignment="Center"
                         KeyDown="AddressBar_KeyDown" />

                <Button Grid.Column="5" Width="64" Margin="0,0,6,0" Content="Go" Click="Go_Click" />

                <Button Grid.Column="6"
                        Name="BookmarksMenuButton"
                        Width="64"
                        Margin="0,0,6,0"
                        Content="â˜…â–¼"
                        ToolTip="Open bookmarks"
                        Click="BookmarksMenu_Click" />

                <ToggleButton Grid.Column="7"
                              Name="BookmarkButton"
                              Width="44"
                              Content="â˜†"
                              ToolTip="Bookmark this page"
                              Click="BookmarkButton_Click" />

                <ToggleButton Grid.Column="8"
                              Name="AiPanelToggle"
                              Width="52"
                              Content="AI"
                              IsChecked="False"
                              ToolTip="Show/hide AI panel"
                              Click="AiPanelToggle_Click" />
            </Grid>
        </Border>

        <!-- Main content -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition x:Name="AiColumn" Width="0" />
            </Grid.ColumnDefinitions>

            <!-- Browser tabs + content -->
            <Grid Grid.Column="0">
                <TabControl x:Name="Tabs"
                            SelectionChanged="Tabs_SelectionChanged">
                    <TabControl.ItemContainerStyle>
                        <Style TargetType="TabItem">
                            <Setter Property="HeaderTemplate">
                                <Setter.Value>
                                    <DataTemplate>
                                        <DockPanel LastChildFill="True" Margin="2,0">
                                            <TextBlock Text="{Binding Header}" Margin="6,0,4,0" />
                                            <Button Width="18"
                                                    Height="18"
                                                    Padding="0"
                                                    Margin="4,0,0,0"
                                                    Content="âœ•"
                                                    Tag="{Binding RelativeSource={RelativeSource AncestorType=TabItem}, Path=Tag}"
                                                    Click="CloseTab_Click" />
                                        </DockPanel>
                                    </DataTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.ItemContainerStyle>
                </TabControl>

                <Button x:Name="NewTabButton"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Width="32"
                        Height="24"
                        Margin="0,2,6,0"
                        Content="ï¼‹"
                        Click="NewTab_Click"
                        ToolTip="New tab"
                        Panel.ZIndex="10" />
            </Grid>

            <!-- AI panel -->
            <Border Grid.Column="1"
                    BorderThickness="1,0,0,0"
                    BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Header / controls -->
                    <StackPanel Grid.Row="0" Margin="10">
                        <TextBlock Text="AI Assistant" FontWeight="SemiBold" FontSize="14" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0" VerticalAlignment="Center" >
                            <StackPanel Width="160" Margin="0,0,8,0">
                                <TextBlock Text="Model" />
                                <ComboBox Name="ModelSelector" SelectedIndex="0">
                                    <ComboBoxItem Content="gemini-2.5-flash" Tag="gemini-2.5-flash" />
                                    <ComboBoxItem Content="gemini-3.0-pro" Tag="gemini-3.0-pro-preview" />
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Width="220">
                                <TextBlock Text="Gemini API Key" />
                                <ComboBox Name="ApiKeyBox"
                                          IsEditable="True"
                                          StaysOpenOnEdit="True"
                                          IsTextSearchEnabled="False" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- Conversation log -->
                    <ScrollViewer Grid.Row="1"
                                  Margin="10,0,10,6"
                                  VerticalScrollBarVisibility="Auto">
                        <TextBlock Name="AiConversation"
                                   TextWrapping="Wrap"
                                   FontFamily="Consolas"
                                   FontSize="12" />
                    </ScrollViewer>

                    <!-- Input area -->
                    <DockPanel Grid.Row="2" Margin="10" LastChildFill="True">
                        <Button Name="AiSendButton"
                                Width="36"
                                Height="36"
                                DockPanel.Dock="Right"
                                Content="âž¤"
                                Click="AiAsk_Click"
                                ToolTip="Send" />
                        <TextBox Name="AiInput"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 Height="72"
                                 VerticalScrollBarVisibility="Auto"
                                 KeyDown="AiQuestion_KeyDown"
                                 Margin="0,0,8,0" />
                    </DockPanel>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>

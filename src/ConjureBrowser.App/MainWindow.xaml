<Window x:Class="ConjureBrowser.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:cef="clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf"
        mc:Ignorable="d"
        Title="Conjure Browser"
        Height="720"
        Width="1200">
    <DockPanel LastChildFill="True">
        <!-- Top toolbar -->
        <Border DockPanel.Dock="Top" Padding="6" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Name="BackButton" Width="36" Margin="0,0,6,0" Content="&lt;" Click="Back_Click" />
                <Button Grid.Column="1" Name="ForwardButton" Width="36" Margin="0,0,6,0" Content="&gt;" Click="Forward_Click" />
                <Button Grid.Column="2" Name="ReloadButton" Width="48" Margin="0,0,6,0" Content="Reload" Click="Reload_Click" />
                <Button Grid.Column="3" Width="48" Margin="0,0,6,0" Content="Home" Click="Home_Click" />

                <TextBox Grid.Column="4"
                         Name="AddressBar"
                         Margin="0,0,6,0"
                         VerticalContentAlignment="Center"
                         KeyDown="AddressBar_KeyDown" />

                <Button Grid.Column="5" Width="64" Margin="0,0,6,0" Content="Go" Click="Go_Click" />

                <Button Grid.Column="6"
                        Name="BookmarksMenuButton"
                        Width="64"
                        Margin="0,0,6,0"
                        Content="★▼"
                        ToolTip="Open bookmarks"
                        Click="BookmarksMenu_Click" />

                <ToggleButton Grid.Column="7"
                              Name="BookmarkButton"
                              Width="44"
                              Content="☆"
                              ToolTip="Bookmark this page"
                              Click="BookmarkButton_Click" />

                <Button Grid.Column="8"
                        Name="SettingsButton"
                        Width="36"
                        Margin="0,0,6,0"
                        Content="⚙"
                        ToolTip="Open settings"
                        Click="SettingsButton_Click" />

                <ToggleButton Grid.Column="9"
                              Name="AiPanelToggle"
                              Width="52"
                              Content="AI"
                              IsChecked="False"
                              ToolTip="Show/hide AI panel"
                              Click="AiPanelToggle_Click" />
            </Grid>
        </Border>

        <!-- Main content -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition x:Name="AiColumn" Width="0" />
            </Grid.ColumnDefinitions>

            <!-- Browser tabs + content -->
            <Grid Grid.Column="0">
                <DockPanel LastChildFill="True">
                    <Button x:Name="NewTabButton"
                            DockPanel.Dock="Right"
                            Width="28"
                            Height="24"
                            Margin="2,2,6,0"
                            Content="+"
                            VerticalAlignment="Top"
                            Click="NewTab_Click"
                            ToolTip="New tab" />

                    <TabControl x:Name="Tabs"
                                SelectionChanged="Tabs_SelectionChanged">
                        <TabControl.ItemContainerStyle>
                            <Style TargetType="TabItem">
                                <Setter Property="HeaderTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <DockPanel LastChildFill="True" Margin="2,0">
                                                <TextBlock Text="{Binding Header, RelativeSource={RelativeSource AncestorType=TabItem}}"
                                                           Margin="6,0,4,0"
                                                           TextTrimming="CharacterEllipsis"
                                                           Width="180" />
                                                <Button Width="16"
                                                        Height="16"
                                                        Padding="0"
                                                        Margin="4,0,4,0"
                                                        Content="×"
                                                        Tag="{Binding RelativeSource={RelativeSource AncestorType=TabItem}}"
                                                        Click="CloseTab_Click" />
                                            </DockPanel>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TabControl.ItemContainerStyle>
                    </TabControl>
                </DockPanel>
            </Grid>

            <!-- AI panel -->
            <Border Grid.Column="1"
                    BorderThickness="1,0,0,0"
                    BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Header / controls -->
                    <StackPanel Grid.Row="0" Margin="10">
                        <TextBlock Text="AI Assistant" FontWeight="SemiBold" FontSize="14" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0" VerticalAlignment="Center">
                            <StackPanel Width="200">
                                <TextBlock Text="Model" />
                                <ComboBox Name="ModelSelector" SelectedIndex="0">
                                    <ComboBoxItem Content="gemini-2.5-flash" Tag="gemini-2.5-flash" />
                                    <ComboBoxItem Content="gemini-3.0-pro" Tag="gemini-3.0-pro" />
                                </ComboBox>
                                <TextBlock Text="API key is set in Settings (⚙)"
                                           Margin="0,6,0,0"
                                           Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                                           FontSize="11" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- Conversation log -->
                    <ScrollViewer Grid.Row="1"
                                  Margin="10,0,10,6"
                                  VerticalScrollBarVisibility="Auto">
                        <TextBlock Name="AiConversation"
                                   TextWrapping="Wrap"
                                   FontFamily="Consolas"
                                   FontSize="12"
                                   PreviewMouseDown="AiConversation_PreviewMouseDown" />
                    </ScrollViewer>

                    <!-- Input area -->
                    <Grid Grid.Row="2" Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="44" />
                        </Grid.ColumnDefinitions>

                        <TextBox Name="AiInput"
                                 Grid.Column="0"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 Height="72"
                                 VerticalScrollBarVisibility="Auto"
                                 KeyDown="AiQuestion_KeyDown"
                                 Margin="0,0,8,0" />

                        <Button Name="AiSendButton"
                                Grid.Column="1"
                                Width="36"
                                Height="36"
                                Content="➤"
                                Click="AiAsk_Click"
                                ToolTip="Send" />
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>
